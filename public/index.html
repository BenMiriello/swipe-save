<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ComfyUI Media Viewer</title>
  <link rel="stylesheet" href="styles.css">
  <!-- ComfyUI Module Styles -->
  <link rel="stylesheet" href="js/comfyui/styles/modal.css">
  <link rel="stylesheet" href="js/comfyui/styles/components.css">
  <!-- Directory Manager Styles -->
  <link rel="stylesheet" href="css/directory-manager.css">
  <!-- ComfyUI Section Components Styles -->
  <link rel="stylesheet" href="css/comfyui-sections.css">
  <!-- Pagination Styles -->
  <link rel="stylesheet" href="css/pagination.css">
  <!-- Alpine List View Styles -->
  <link rel="stylesheet" href="css/alpine-list-view.css">

  <!-- Core Application Initialization -->
  <script src="js/core/app-init.js"></script>
</head>
<body>
  <div class="container">
    <div class="header-container">
      <div class="header-left">
        <div class="options-container">
          <button class="btn btn-options">Options</button>
          <div class="options-dropdown">
            <ul>
              <!-- Source Directories Section -->
              <li class="section-header">
                <span class="section-title">üìÅ Source Folders</span>
              </li>
              <li class="directory-management">
                <div id="sourceDirectoriesContainer">
                  <div class="loading-state">Loading directories...</div>
                </div>
                <div class="directory-actions">
                  <button id="addDirectoryBtn" class="btn btn-small">+ Add Folder</button>
                  <button id="addGroupBtn" class="btn btn-small">+ Create Group</button>
                </div>
              </li>
              
              <!-- Destination Section -->
              <li class="separator"></li>
              <li class="section-header">
                <span class="section-title">üìÅ Destination</span>
              </li>
              <li class="directory-row">
                <div class="dir-info">
                  <span id="currentDestinationPath">Loading...</span>
                  <button id="changeDestinationBtn" class="btn btn-small">Change</button>
                </div>
              </li>
              
              <!-- Settings Section -->
              <li class="separator"></li>
              <li class="section-header">
                <span class="section-title">‚öôÔ∏è Settings</span>
              </li>
              <li class="toggle-option">
                <label class="toggle-label">
                  <input type="checkbox" id="useDatestampFolders" checked>
                  <span class="toggle-text">Use Datestamp Folders</span>
                </label>
              </li>
              <li class="toggle-option">
                <label class="toggle-label">
                  <input type="checkbox" id="enableLogging">
                  <span class="toggle-text">Enable Logging</span>
                </label>
              </li>
              <li class="toggle-option">
                <label class="toggle-label">
                  <input type="checkbox" id="saveCopiesWhenSorting" checked>
                  <span class="toggle-text">Save copies when sorting</span>
                </label>
              </li>
              
              <!-- Sort Options Section -->
              <li class="separator"></li>
              <li class="section-header">
                <span class="section-title sort-section-toggle" onclick="toggleSortSection()">
                  <span id="sortSectionCaret" class="sort-caret">‚ñ∂</span>
                  üìä Sort Options
                </span>
              </li>
              <li id="sortOptionsContainer" class="sort-options-container" style="display: none;">
                <div class="sort-options">
                  <div class="sort-option-row">
                    <label class="sort-label">Sort by:</label>
                    <select id="sortField" class="sort-select">
                      <option value="date">Date Modified</option>
                      <option value="name">Name</option>
                      <option value="size">File Size</option>
                      <option value="created">Date Created</option>
                    </select>
                  </div>
                  <div class="sort-option-row">
                    <label class="sort-label">Order:</label>
                    <select id="sortOrder" class="sort-select">
                      <option value="desc">Newest First</option>
                      <option value="asc">Oldest First</option>
                    </select>
                  </div>
                </div>
              </li>
              
              <!-- Pagination Settings Section -->
              <li class="separator"></li>
              <li class="section-header">
                <span class="section-title">üìÑ Pagination</span>
              </li>
              <li class="sort-option-row">
                <label class="sort-label">Items per page:</label>
                <select id="globalItemsPerPage" class="sort-select">
                  <option value="50">50</option>
                  <option value="100" selected>100</option>
                  <option value="200">200</option>
                  <option value="500">500</option>
                </select>
              </li>
              <li class="sort-option-row">
                <label class="sort-label">Memory limit:</label>
                <select id="memoryLimit" class="sort-select">
                  <option value="50">50 MB</option>
                  <option value="100" selected>100 MB</option>
                  <option value="200">200 MB</option>
                  <option value="500">500 MB</option>
                </select>
              </li>
              <li class="toggle-option">
                <label class="toggle-label">
                  <input type="checkbox" id="showPreviews" checked>
                  <span class="toggle-text">Show Previews in List</span>
                </label>
              </li>
              <li class="separator"></li>
              <li id="customName">Custom Name</li>
              <li id="showInfo">Show Instructions</li>
            </ul>
          </div>
        </div>
        
        <!-- Navigation Buttons - Just to the right of Options -->
        <button id="backToListButton" class="icon-button nav-button" title="Back to List" style="display: block; margin-left: 8px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H6m6 6l-6-6 6-6"/>
          </svg>
        </button>
        
        <button id="openFileButton" class="icon-button nav-button" title="Open File" style="display: block; margin-left: 8px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <circle cx="9" cy="9" r="2"/>
            <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
          </svg>
        </button>
        
        <button id="listViewButton" class="icon-button back-to-list-icon" title="Back to List View" style="display: none;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
      </div>
      
      <!-- Unified Navigation Component -->
      <div class="nav-shortcuts" id="navShortcuts" style="display: flex; align-items: center; gap: 8px; margin-left: 16px;">
        <!-- List View Button (shown in single view) -->
        <button class="icon-button nav-list-btn" id="navListBtn" title="File List" style="display: none;" onclick="goToListView()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="6" x2="21" y2="6"></line>
            <line x1="8" y1="12" x2="21" y2="12"></line>
            <line x1="8" y1="18" x2="21" y2="18"></line>
            <line x1="3" y1="6" x2="3.01" y2="6"></line>
            <line x1="3" y1="12" x2="3.01" y2="12"></line>
            <line x1="3" y1="18" x2="3.01" y2="18"></line>
          </svg>
        </button>
        
      </div>
      
      <h1 id="appTitle">Swipe-Save</h1>
      <div class="header-icons">
        <button class="icon-button reload-icon" title="Reload Media">
          <svg width="50px" height="50px" stroke="currentColor" stroke-width="1" fill="currentColor" color="currentColor" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg"><path d="M25 38c-7.2 0-13-5.8-13-13 0-3.2 1.2-6.2 3.3-8.6l1.5 1.3C15 19.7 14 22.3 14 25c0 6.1 4.9 11 11 11 1.6 0 3.1-.3 4.6-1l.8 1.8c-1.7.8-3.5 1.2-5.4 1.2z"/><path d="M34.7 33.7l-1.5-1.3c1.8-2 2.8-4.6 2.8-7.3 0-6.1-4.9-11-11-11-1.6 0-3.1.3-4.6 1l-.8-1.8c1.7-.8 3.5-1.2 5.4-1.2 7.2 0 13 5.8 13 13 0 3.1-1.2 6.2-3.3 8.6z"/><path d="M18 24h-2v-6h-6v-2h8z"/><path d="M40 34h-8v-8h2v6h6z"/></svg>
        </button>
        <button class="icon-button save-icon" title="Download">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
        </button>
        <button class="icon-button comfyui-icon" title="Load in ComfyUI">&#x2192;</button>
      </div>
    </div>

    <div class="media-container">
      <!-- Media items will be loaded here -->
      <div id="mediaList" class="media-list"></div>
    </div>
  </div>

  <!-- Modal for custom filename -->
  <div id="filenameModal" class="modal">
    <div class="modal-content">
      <h2>
        <span class="modal-title">Custom Filename</span>
        <span class="close-modal">&times;</span>
      </h2>
      <input type="text" id="customFilename" placeholder="Enter new filename">
      <button id="saveFilename">Save</button>
    </div>
  </div>


  <!-- ComfyUI Modal Container (loaded dynamically) -->
  <div id="comfyui-modal-container"></div>

  <!-- External libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>

  <!-- Template Loading (must load early) -->
  <script src="js/core/template-loader.js"></script>

  <!-- Core Application -->
  <script src="js/error-handler.js"></script>
  <script src="js/config.js"></script>
  
  <!-- API Layer -->
  <script src="js/api/file-api.js"></script>
  <script src="js/api/config-api.js"></script>
  <script src="js/api/copy-api.js"></script>
  <script src="js/api-service.js"></script>
  <script src="js/api/directory-api.js"></script>
  
  <!-- Pagination System -->
  <script src="js/pagination/pagination-state.js"></script>
  <script src="js/components/list-pagination.js"></script>
  
  <!-- ComfyUI Services -->
  <script src="js/comfyui/services/api-client.js"></script>
  <script src="js/comfyui/services/storage-service.js"></script>
  
  <!-- State Stores -->
  <script src="js/comfyui/stores/workflow-store.js"></script>
  <script src="js/comfyui/stores/destination-store.js"></script>
  <script src="js/comfyui/stores/queue-store.js"></script>
  <script src="js/stores/app-state-store.js"></script>
  <script src="js/stores/list-view-store.js"></script>
  
  <!-- ComfyUI Components -->
  <script src="js/comfyui/components/section-components.js"></script>
  <script src="js/comfyui/components/modal-components.js"></script>
  <script src="js/comfyui/components/panel-components.js"></script>
  <script src="js/comfyui/index.js"></script>
  <script src="js/comfyui/test.js"></script>
  
  <!-- BentoML Integration -->
  <script src="js/comfyui-bentoml/services/bentoml-client.js"></script>

  <!-- Core Unified System -->
  <script src="js/comfyui-bentoml/core/field-types.js"></script>
  <script src="js/comfyui-bentoml/core/workflow-parser.js"></script>
  <script src="js/comfyui-bentoml/core/field-detector.js"></script>

  <!-- Consolidated Service Providers -->
  <script src="js/comfyui-bentoml/services/schema-provider.js"></script>
  <script src="js/comfyui-bentoml/services/dropdown-provider.js"></script>
  <script src="js/comfyui-bentoml/services/field-type-detector.js"></script>
  <script src="js/comfyui-bentoml/services/text-field-detector.js"></script>
  <script src="js/comfyui-bentoml/services/seed-field-detector.js"></script>
  <script src="js/comfyui-bentoml/adapters/ui-adapter.js"></script>
  <script src="js/comfyui-bentoml/extractors/seed-extractor.js"></script>
  <script src="js/comfyui-bentoml/extractors/text-extractor.js"></script>
  <script src="js/comfyui-bentoml/extractors/parameter-extractor.js"></script>
  <script src="js/comfyui-bentoml/extractors/field-extractor.js"></script>
  <script src="js/comfyui-bentoml/editors/field-editor.js"></script>
  <script src="js/comfyui-bentoml/index.js"></script>
  <script src="js/comfyui-bentoml/test-only.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js" defer></script>
  
  <!-- Shared Components -->
  <script src="js/shared/toolbar.js"></script>
  <script src="js/shared/navigation.js"></script>
  <script src="js/shared/queue-viewer.js"></script>
  
  <!-- UI Management -->
  <script src="js/ui/core-ui-manager.js"></script>
  <script src="js/ui/element-factory.js"></script>
  <script src="js/ui/modal-manager.js"></script>
  <script src="js/ui/directory-browser.js"></script>
  <script src="js/ui/sort-manager.js"></script>
  <script src="js/ui-manager.js"></script>
  
  <!-- Directory Manager Modules -->
  <script src="js/ui/directory-manager/config-manager.js"></script>
  <script src="js/ui/directory-manager/first-run.js"></script>
  <script src="js/ui/directory-manager/modal-factory.js"></script>
  <script src="js/ui/directory-manager/event-handlers.js"></script>
  <script src="js/ui/directory-manager/ui-updater.js"></script>
  <script src="js/ui/directory-manager.js"></script>
  
  <!-- Controllers -->
  <script src="js/controllers/state-manager.js"></script>
  <script src="js/controllers/action-controller.js"></script>
  <script src="js/controllers/navigation-controller.js"></script>
  
  <!-- Main Application -->
  <script src="js/interaction-handler.js"></script>
  <script src="js/app-controller.js"></script>
  
  <!-- Views -->
  <script src="js/simple-list-view.js"></script>
  <script src="js/alpine-list-view.js"></script>
  
  <!-- Navigation -->
  <script src="js/navigation/navigation-functions.js"></script>
  <script src="js/navigation/view-router.js"></script>
  
  <!-- UI Components -->
  <script src="js/components/ui/collapsible-section.js"></script>
</body>
</html>
