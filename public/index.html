<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ComfyUI Media Viewer</title>
  <link rel="stylesheet" href="styles.css">
  <!-- ComfyUI Module Styles -->
  <link rel="stylesheet" href="js/comfyui/styles/modal.css">
  <link rel="stylesheet" href="js/comfyui/styles/components.css">
  <!-- Directory Manager Styles -->
  <link rel="stylesheet" href="css/directory-manager.css">
  <!-- ComfyUI Section Components Styles -->
  <link rel="stylesheet" href="css/comfyui-sections.css">
  <!-- Pagination Styles -->
  <link rel="stylesheet" href="css/pagination.css">
  <!-- Alpine List View Styles -->
  <link rel="stylesheet" href="css/alpine-list-view.css">
  <!-- Input Manager Styles -->
  <link rel="stylesheet" href="css/input-manager.css">
  <link rel="stylesheet" href="css/filter-modal.css">

  <!-- Core Application Initialization -->
  <script src="js/core/app-init.js"></script>
  <script src="js/core/event-manager.js"></script>
  <script src="js/core/event-setup.js"></script>
</head>
<body x-data="{ }" x-init="$store.filters.init()">
  <div class="container">
    <div class="header-container">
      <div class="header-left">
        <div class="options-container">
          <button class="btn btn-options">Options</button>
          <div class="options-dropdown">
            <ul>
              <!-- Source Directories Section -->
              <li class="section-header">
                <span class="section-title">üìÅ Source Folders</span>
              </li>
              <li class="directory-management">
                <div id="sourceDirectoriesContainer">
                  <div class="loading-state">Loading directories...</div>
                </div>
                <div class="directory-actions">
                  <button id="addDirectoryBtn" class="btn btn-small">+ Add Folder</button>
                  <button id="addGroupBtn" class="btn btn-small">+ Create Group</button>
                </div>
              </li>
              
              <!-- Destination Section -->
              <li class="separator"></li>
              <li class="section-header">
                <span class="section-title">üìÅ Destination</span>
              </li>
              <li class="directory-row">
                <div class="dir-info">
                  <span id="currentDestinationPath">Loading...</span>
                  <button id="changeDestinationBtn" class="btn btn-small">Change</button>
                </div>
              </li>
              
              <!-- Settings Section -->
              <li class="separator"></li>
              <li class="section-header">
                <span class="section-title">‚öôÔ∏è Settings</span>
              </li>
              <li class="toggle-option">
                <label class="toggle-label">
                  <input type="checkbox" id="useDatestampFolders" checked>
                  <span class="toggle-text">Use Datestamp Folders</span>
                </label>
              </li>
              <li class="toggle-option">
                <label class="toggle-label">
                  <input type="checkbox" id="enableLogging">
                  <span class="toggle-text">Enable Logging</span>
                </label>
              </li>
              <li class="toggle-option">
                <label class="toggle-label">
                  <input type="checkbox" id="saveCopiesWhenSorting" checked>
                  <span class="toggle-text">Save copies when sorting</span>
                </label>
              </li>
              
              <!-- Sort Options Section -->
              <li class="separator"></li>
              <li class="section-header">
                <span class="section-title sort-section-toggle" onclick="toggleSortSection()">
                  <span id="sortSectionCaret" class="sort-caret">‚ñ∂</span>
                  üìä Sort Options
                </span>
              </li>
              <li id="sortOptionsContainer" class="sort-options-container" style="display: none;">
                <div class="sort-options">
                  <div class="sort-option-row">
                    <label class="sort-label">Sort by:</label>
                    <select id="sortField" class="sort-select">
                      <option value="date">Date Modified</option>
                      <option value="name">Name</option>
                      <option value="size">File Size</option>
                      <option value="created">Date Created</option>
                    </select>
                  </div>
                  <div class="sort-option-row">
                    <label class="sort-label">Order:</label>
                    <select id="sortOrder" class="sort-select">
                      <option value="desc">Newest First</option>
                      <option value="asc">Oldest First</option>
                    </select>
                  </div>
                </div>
              </li>
              
              <!-- Pagination Settings Section -->
              <li class="separator"></li>
              <li class="section-header">
                <span class="section-title">üìÑ Pagination</span>
              </li>
              <li class="sort-option-row">
                <label class="sort-label">Items per page:</label>
                <select id="globalItemsPerPage" class="sort-select">
                  <option value="50">50</option>
                  <option value="100" selected>100</option>
                  <option value="200">200</option>
                  <option value="500">500</option>
                </select>
              </li>
              <li class="sort-option-row">
                <label class="sort-label">Memory limit:</label>
                <select id="memoryLimit" class="sort-select">
                  <option value="50">50 MB</option>
                  <option value="100" selected>100 MB</option>
                  <option value="200">200 MB</option>
                  <option value="500">500 MB</option>
                </select>
              </li>
              <li class="toggle-option">
                <label class="toggle-label">
                  <input type="checkbox" id="showPreviews" checked>
                  <span class="toggle-text">Show Previews in List</span>
                </label>
              </li>
              <li class="separator"></li>
              <li id="customName">Custom Name</li>
              <li id="showInfo">Show Instructions</li>
            </ul>
          </div>
        </div>
        
        <!-- Navigation Buttons - Just to the right of Options -->
        <button id="backToListButton" class="icon-button nav-button" title="Back to List" style="display: block; margin-left: 8px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H6m6 6l-6-6 6-6"/>
          </svg>
        </button>
        
        <button id="openFileButton" class="icon-button nav-button" title="Open File" style="display: block; margin-left: 8px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <circle cx="9" cy="9" r="2"/>
            <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
          </svg>
        </button>
        
        <button id="listViewButton" class="icon-button back-to-list-icon" title="Back to List View" style="display: none;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        
        <button id="filterButton" class="icon-button" title="Filter Media" @click="$store.filters.toggle()" 
                :class="{ 'filter-active': $store.filters.hasActiveFilters() }">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"></polygon>
          </svg>
        </button>
      </div>
      
      <!-- Unified Navigation Component -->
      <div class="nav-shortcuts" id="navShortcuts" style="display: flex; align-items: center; gap: 8px; margin-left: 16px;">
        <!-- List View Button (shown in single view) -->
        <button class="icon-button nav-list-btn" id="navListBtn" title="File List" style="display: none;" onclick="goToListView()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="6" x2="21" y2="6"></line>
            <line x1="8" y1="12" x2="21" y2="12"></line>
            <line x1="8" y1="18" x2="21" y2="18"></line>
            <line x1="3" y1="6" x2="3.01" y2="6"></line>
            <line x1="3" y1="12" x2="3.01" y2="12"></line>
            <line x1="3" y1="18" x2="3.01" y2="18"></line>
          </svg>
        </button>
        
      </div>
      
      <h1 id="appTitle">Swipe-Save</h1>
      <div class="header-icons">
        <button class="icon-button reload-icon" title="Reload Media">
          <svg width="50px" height="50px" stroke="currentColor" stroke-width="1" fill="currentColor" color="currentColor" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg"><path d="M25 38c-7.2 0-13-5.8-13-13 0-3.2 1.2-6.2 3.3-8.6l1.5 1.3C15 19.7 14 22.3 14 25c0 6.1 4.9 11 11 11 1.6 0 3.1-.3 4.6-1l.8 1.8c-1.7.8-3.5 1.2-5.4 1.2z"/><path d="M34.7 33.7l-1.5-1.3c1.8-2 2.8-4.6 2.8-7.3 0-6.1-4.9-11-11-11-1.6 0-3.1.3-4.6 1l-.8-1.8c1.7-.8 3.5-1.2 5.4-1.2 7.2 0 13 5.8 13 13 0 3.1-1.2 6.2-3.3 8.6z"/><path d="M18 24h-2v-6h-6v-2h8z"/><path d="M40 34h-8v-8h2v6h6z"/></svg>
        </button>
        <button class="icon-button save-icon" title="Download">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
        </button>
        <button class="icon-button comfyui-icon" title="Load in ComfyUI">&#x2192;</button>
      </div>
    </div>

    <div class="media-container">
      <!-- Media items will be loaded here -->
      <div id="mediaList" class="media-list"></div>
    </div>

    <!-- Dedicated List View Container -->
    <div id="list-view-container" class="list-view-container" style="display: none;">
      <!-- List view content will be loaded here -->
    </div>
  </div>

  <!-- Modal for custom filename -->
  <div id="filenameModal" class="modal">
    <div class="modal-content">
      <h2>
        <span class="modal-title">Custom Filename</span>
        <span class="close-modal">&times;</span>
      </h2>
      <input type="text" id="customFilename" placeholder="Enter new filename">
      <button id="saveFilename">Save</button>
    </div>
  </div>


  <!-- ComfyUI Modal Container (loaded dynamically) -->
  <div id="comfyui-modal-container"></div>

  <!-- External libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>

  <!-- Template Loading (must load early) -->
  <script src="js/core/template-loader.js"></script>

  <!-- Core Application -->
  <script src="js/error-handler.js"></script>
  <script src="js/config.js"></script>
  
  <!-- API Layer -->
  <script src="js/api/file-api.js"></script>
  <script src="js/api/config-api.js"></script>
  <script src="js/api/copy-api.js"></script>
  <script src="js/api-service.js"></script>
  <script src="js/api/directory-api.js"></script>
  
  <!-- Pagination System -->
  <script src="js/pagination/pagination-state.js"></script>
  <script src="js/components/list-pagination.js"></script>
  
  <!-- ComfyUI Services -->
  <script src="js/comfyui/services/api-client.js"></script>
  <script src="js/comfyui/services/storage-service.js"></script>
  
  <!-- State Stores -->
  <script src="js/comfyui/stores/workflow-store.js"></script>
  <script src="js/comfyui/stores/destination-store.js"></script>
  <script src="js/comfyui/stores/queue-store.js"></script>
  <script src="js/stores/app-state-store.js"></script>
  <script src="js/stores/list-view-store.js"></script>
  <script src="js/stores/filter-store.js"></script>
  <script src="js/components/filter-ui.js"></script>
  
  <!-- ComfyUI Components -->
  <script src="js/comfyui/components/section-components.js"></script>
  <script src="js/comfyui/components/modal-components.js"></script>
  <script src="js/comfyui/components/panel-components.js"></script>
  <script src="js/comfyui/index.js"></script>
  <script src="js/comfyui/test.js"></script>
  
  <!-- BentoML Integration -->
  <script src="js/comfyui-bentoml/services/bentoml-client.js"></script>

  <!-- Core Unified System -->
  <script src="js/comfyui-bentoml/core/field-types.js"></script>
  <script src="js/comfyui-bentoml/core/workflow-parser.js"></script>
  <script src="js/comfyui-bentoml/core/field-detector.js"></script>

  <!-- Consolidated Service Providers -->
  <script src="js/comfyui-bentoml/services/schema-provider.js"></script>
  <script src="js/comfyui-bentoml/services/dropdown-provider.js"></script>
  <script src="js/comfyui-bentoml/services/field-editor-service.js"></script>
  <script src="js/comfyui-bentoml/services/field-edit-session.js"></script>
  <script src="js/comfyui-bentoml/services/field-type-detector.js"></script>
  <script src="js/comfyui-bentoml/services/text-field-detector.js"></script>
  <script src="js/comfyui-bentoml/services/seed-field-detector.js"></script>
  <script src="js/comfyui-bentoml/adapters/ui-adapter.js"></script>
  <script src="js/comfyui-bentoml/extractors/seed-extractor.js"></script>
  <script src="js/comfyui-bentoml/extractors/text-extractor.js"></script>
  <script src="js/comfyui-bentoml/extractors/parameter-extractor.js"></script>
  <script src="js/comfyui-bentoml/extractors/field-extractor.js"></script>
  <script src="js/comfyui-bentoml/editors/field-editor-ui.js"></script>
  <script src="js/comfyui-bentoml/index.js"></script>
  <script src="js/comfyui-bentoml/test-only.js"></script>
  
  <!-- Input Manager -->
  <script src="js/input-manager/utils/input-config-manager.js"></script>
  <script src="js/input-manager/core/input-database.js"></script>
  <script src="js/input-manager/core/input-file-service.js"></script>
  <script src="js/input-manager/index.js"></script>
  <!-- Input Manager UI Components -->
  <script src="js/input-manager/utils/input-sort-filter.js"></script>
  <script src="js/input-manager/ui/input-grid-component.js"></script>
  <script src="js/input-manager/ui/input-picker-modal.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js" defer></script>
  
  <!-- Shared Components -->
  <script src="js/shared/toolbar.js"></script>
  <script src="js/shared/navigation.js"></script>
  <script src="js/shared/queue-viewer.js"></script>
  
  <!-- UI Management -->
  <script src="js/ui/core-ui-manager.js"></script>
  <script src="js/ui/element-factory.js"></script>
  <script src="js/ui/modal-manager.js"></script>
  <script src="js/ui/directory-browser.js"></script>
  <script src="js/ui/sort-manager.js"></script>
  <script src="js/ui-manager.js"></script>
  
  <!-- Directory Manager Modules -->
  <script src="js/ui/directory-manager/config-manager.js"></script>
  <script src="js/ui/directory-manager/first-run.js"></script>
  <script src="js/ui/directory-manager/modal-factory.js"></script>
  <script src="js/ui/directory-manager/event-handlers.js"></script>
  <script src="js/ui/directory-manager/ui-updater.js"></script>
  <script src="js/ui/directory-manager.js"></script>
  
  <!-- Controllers -->
  <script src="js/controllers/state-manager.js"></script>
  <script src="js/controllers/action-controller.js"></script>
  <script src="js/controllers/navigation-controller.js"></script>
  
  <!-- Main Application -->
  <script src="js/interaction-handler.js"></script>
  <script src="js/app-controller.js"></script>
  
  <!-- Views -->
  <script src="js/simple-list-view.js"></script>
  <script src="js/alpine-list-view.js"></script>
  
  <!-- Navigation -->
  <script src="js/navigation/navigation-functions.js"></script>
  <script src="js/navigation/view-router.js"></script>
  
  <!-- UI Components -->
  <script src="js/components/ui/collapsible-section.js"></script>

  <!-- Filter Modal -->
  <div x-data="createFilterComponent()" 
       x-show="$store.filters.active" 
       x-transition.opacity.duration.200ms
       @keydown.window="handleKeydown($event)"
       class="filter-modal-overlay" 
       style="display: none;">
    
    <!-- Modal Background (no click to close) -->
    <div class="filter-modal-backdrop"></div>
    
    <!-- Modal Content -->
    <div class="filter-modal" @click.stop>
      <!-- Modal Header (Sticky) -->
      <div class="filter-modal-header filter-sticky-header">
        <h3>Advanced Filters</h3>
      </div>
      
      <!-- Scrollable Content Area -->
      <div class="filter-modal-body">
      
      <!-- Filter Fields -->
      <div class="filter-fields">
        <!-- Filename Filter -->
        <div class="filter-field">
          <div class="filter-label-with-info">
            <label for="filter-filename">Filename</label>
            <button @click="toggleInfo('filename')" 
                    class="filter-info-btn" 
                    title="Show format examples">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="m9,9 0,0 a3,3 0 1,1 6,0c0,2 -3,3 -3,3"></path>
                <path d="m9,17 6,0"></path>
              </svg>
            </button>
          </div>
          <div class="filter-input-group">
            <input type="text" 
                   id="filter-filename"
                   x-model="$store.filters.currentFilters.filename"
                   placeholder="*.png, ComfyUI_*, etc..."
                   class="filter-input">
            <button x-show="hasFilterContent('filename')" 
                    @click="clearFilterField('filename')" 
                    class="filter-clear-btn" 
                    title="Clear">√ó</button>
          </div>
          <div x-show="showInfo.filename" 
               x-transition.opacity.duration.200ms
               class="filter-info-row">
            <small class="filter-info-text">
              Examples: <code>*.png</code> (all PNG files), <code>ComfyUI_*</code> (starts with ComfyUI), 
              <code>*lightning*</code> (contains lightning), <code>folder/file.png</code> (specific path)
            </small>
          </div>
        </div>
        
        <!-- Size Filter -->
        <div class="filter-field">
          <div class="filter-collapsible">
            <button @click="toggleCollapsible('size')" 
                    class="filter-collapsible-header" 
                    type="button">
              <span class="filter-collapsible-title">File Size</span>
              <div class="filter-collapsible-right">
                <span x-show="getSizeSummary() !== 'Any Size'" 
                      class="filter-collapsible-summary" 
                      x-text="getSizeSummary()"></span>
                <svg class="filter-collapsible-icon" 
                     :class="{ 'rotated': showCollapsible.size }"
                     width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6,9 12,15 18,9"></polyline>
                </svg>
              </div>
            </button>
            <div x-show="showCollapsible.size" 
                 x-transition:enter.duration.200ms
                 x-transition:leave.duration.150ms
                 class="filter-collapsible-content">
              <div class="filter-size-controls">
                <div class="size-slider-group">
                  <label class="size-slider-label">Minimum Size</label>
                  <div class="size-slider-container">
                    <input type="range" 
                           id="filter-size-min"
                           x-model="sizeMin"
                           min="0" max="100" step="1"
                           class="size-slider">
                    <span class="size-slider-value" x-text="formatSizeValue(sizeMin)"></span>
                  </div>
                </div>
                <div class="size-slider-group">
                  <label class="size-slider-label">Maximum Size</label>
                  <div class="size-slider-container">
                    <input type="range" 
                           id="filter-size-max"
                           x-model="sizeMax"
                           min="0" max="100" step="1"
                           class="size-slider">
                    <span class="size-slider-value" x-text="formatSizeValue(sizeMax)"></span>
                  </div>
                </div>
                <button x-show="sizeMin > 0 || sizeMax < 100" 
                        @click="resetSizeFilter()" 
                        class="filter-clear-btn size-clear-btn" 
                        title="Clear Size Filter">Clear</button>
              </div>
              <div class="size-examples">
                <small class="size-examples-text">Examples: Any Size, 1MB-50MB, >10MB, <500KB</small>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Date Filter -->
        <div class="filter-field">
          <div class="filter-collapsible">
            <button @click="toggleCollapsible('date')" 
                    class="filter-collapsible-header" 
                    type="button">
              <span class="filter-collapsible-title">Date Range</span>
              <div class="filter-collapsible-right">
                <span x-show="getDateSummary() !== 'Any Date'" 
                      class="filter-collapsible-summary" 
                      x-text="getDateSummary()"></span>
                <svg class="filter-collapsible-icon" 
                     :class="{ 'rotated': showCollapsible.date }"
                     width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6,9 12,15 18,9"></polyline>
                </svg>
              </div>
            </button>
            <div x-show="showCollapsible.date" 
                 x-transition:enter.duration.200ms
                 x-transition:leave.duration.150ms
                 class="filter-collapsible-content">
              <div class="date-range-controls">
                <div class="date-input-group">
                  <label class="date-label">From Date</label>
                  <input type="date" 
                         x-model="startDate"
                         class="date-input">
                </div>
                <div class="date-input-group">
                  <label class="date-label">To Date</label>
                  <input type="date" 
                         x-model="endDate"
                         class="date-input">
                </div>
                <button x-show="startDate || endDate" 
                        @click="resetDateFilter()" 
                        class="filter-clear-btn date-clear-btn" 
                        title="Clear Date Filter">Clear</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Metadata Filter (conditionally shown) -->
        <div class="filter-field" x-show="$store.filters.includeWorkflowMetadata">
          <div class="filter-label-with-info">
            <label for="filter-metadata">Workflow Content</label>
            <button @click="toggleInfo('metadata')" class="filter-info-btn" title="Show search examples">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <div x-show="showInfo.metadata" class="filter-info-row">
            <small class="filter-info-text">
              Examples: <code>KSampler</code> (find KSampler nodes), <code>checkpoint</code> (find checkpoint references), <code>LoRA</code> (find LoRA usage)
            </small>
          </div>
          <div class="filter-input-group">
            <input type="text" 
                   id="filter-metadata"
                   x-model="$store.filters.currentFilters.metadata"
                   placeholder="Search in workflow JSON..."
                   class="filter-input">
            <button x-show="hasFilterContent('metadata')" 
                    @click="clearFilterField('metadata')" 
                    class="filter-clear-btn" 
                    title="Clear">√ó</button>
          </div>
        </div>
      </div>

      <!-- Input File Metadata Filter -->
      <div class="filter-section">
        <div class="filter-field">
          <div class="filter-label-with-info">
            <label for="filter-input-metadata">Input File Content</label>
            <button @click="toggleInfo('inputMetadata')" class="filter-info-btn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <div x-show="showInfo.inputMetadata" class="filter-info-row">
            <small class="filter-info-text">
              Search in metadata of input images used by the workflow. Same syntax as filename filter. Examples: <code>*portrait*</code> (contains "portrait"), <code>1024</code> (files with 1024 dimensions), <code>*.png</code> (PNG input files)
            </small>
          </div>
          <div class="filter-input-group">
            <input type="text" 
                   id="filter-input-metadata"
                   x-model="$store.filters.currentFilters.inputMetadata"
                   placeholder="Search in input file metadata..."
                   class="filter-input">
            <button x-show="hasFilterContent('inputMetadata')" 
                    @click="clearFilterField('inputMetadata')" 
                    class="filter-clear-btn" 
                    title="Clear">√ó</button>
          </div>
        </div>
      </div>
      
      <!-- Media Types -->
      <div class="filter-section">
        <h4>Media Types</h4>
        <div class="filter-media-types">
          <template x-for="type in $store.filters.availableMediaTypes" :key="type">
            <label class="filter-checkbox-label">
              <input type="checkbox" 
                     :checked="$store.filters.isMediaTypeSelected(type)"
                     @change="$store.filters.toggleMediaType(type)">
              <span x-text="type.toUpperCase()"></span>
            </label>
          </template>
        </div>
      </div>
      
      <!-- Advanced Options -->
      <div class="filter-section">
        <h4>Advanced Options</h4>
        <label class="filter-checkbox-label">
          <input type="checkbox" x-model="$store.filters.includeWorkflowMetadata">
          <span>Include ComfyUI workflow metadata</span>
        </label>
        <label class="filter-checkbox-label">
          <input type="checkbox" x-model="$store.filters.caseSensitive">
          <span>Case sensitive search</span>
        </label>
      </div>
      
      <!-- Presets Section -->
      <div class="filter-presets-section" x-show="$store.filters.presets.length > 0">
        <h4>Saved Presets</h4>
        <div class="filter-presets-grid">
          <template x-for="preset in $store.filters.presets" :key="preset.id">
            <div class="filter-preset-item">
              <button @click="loadPreset(preset.id)" class="filter-preset-load" :title="preset.description || ''">
                <span x-text="preset.name"></span>
                <small x-show="preset.description" x-text="preset.description"></small>
              </button>
              <button @click="deletePreset(preset.id, preset.name)" class="filter-preset-delete" title="Delete preset">√ó</button>
            </div>
          </template>
        </div>
      </div>
      
      </div>
      
      <!-- Filter Summary & Results (Sticky Footer) -->
      <div class="filter-modal-footer filter-sticky-footer">
        <div class="filter-results-info">
          <div class="filter-summary" x-show="$store.filters.hasActiveFilters()">
            <span class="filter-summary-text" x-text="getFilterSummary()"></span>
          </div>
          <div class="filter-live-count">
            <span x-show="$store.filters.previewResultCount !== null" class="filter-count">
              <strong x-text="$store.filters.previewResultCount"></strong> files
              <span x-show="$store.filters.hasActiveFilters()">match filters</span>
              <span x-show="!$store.filters.hasActiveFilters()">total</span>
            </span>
            <span x-show="$store.filters.previewResultCount === null && $store.filters.previewActive" class="filter-count-loading">
              Updating count...
            </span>
          </div>
        </div>
        
        <!-- Modal Actions -->
        <div class="filter-modal-actions">
          <div class="filter-actions-left">
            <button @click="showSavePresetDialog()" 
                    :disabled="!$store.filters.hasActiveFilters()"
                    class="filter-btn filter-btn-secondary">
              Save Preset
            </button>
          </div>
          
          <div class="filter-actions-center">
            <button @click="clearFilters()" 
                    :disabled="!$store.filters.hasActiveFilters()"
                    class="filter-btn filter-btn-secondary">
              Clear All
            </button>
          </div>
          
          <div class="filter-actions-right">
            <button @click="$store.filters.cancelFilters(); $store.filters.close()" 
                    class="filter-btn filter-btn-secondary">
              Cancel
            </button>
            <button @click="$store.filters.saveFilters(); $store.filters.close()" 
                    :disabled="$store.filters.isLoading"
                    class="filter-btn filter-btn-primary">
              <span x-show="!$store.filters.isLoading">Save</span>
              <span x-show="$store.filters.isLoading">Saving...</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Save Preset Dialog -->
    <div x-show="showSaveDialog" 
         x-transition.opacity.duration.200ms
         class="filter-save-dialog" 
         @click.stop>
      <h4>Save Filter Preset</h4>
      <input type="text" 
             id="preset-name-input"
             x-model="newPresetName"
             placeholder="Enter preset name..."
             @keydown.enter="savePreset()"
             @keydown.escape="cancelSavePreset()"
             class="filter-input">
      <div class="filter-save-actions">
        <button @click="cancelSavePreset()" class="filter-btn filter-btn-secondary">Cancel</button>
        <button @click="savePreset()" class="filter-btn filter-btn-primary">Save</button>
      </div>
    </div>
  </div>
</body>
</html>
